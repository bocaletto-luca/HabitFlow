<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>HabitFlow ‚Äì Daily Habit Tracker</title>
  <meta name="description" content="HabitFlow: one-page daily habit tracker with monthly, weekly, daily views, reminders, stats, export/import, and dark mode.">
  <meta name="author" content="Bocaletto Luca"/>
  <style>
    :root {
      --bg: #f4f4f4;
      --card: #fff;
      --text: #333;
      --primary: #00509e;
      --primary-dark: #003f7d;
    }
    [data-theme="dark"] {
      --bg: #1e1e1e;
      --card: #2c2c2c;
      --text: #ddd;
      --primary: #339af0;
      --primary-dark: #1c7ed6;
    }
    * { box-sizing:border-box; margin:0; padding:0; }
    body {
      display:flex; flex-direction:column;
      min-height:100vh;
      font-family:Arial,sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    header, footer {
      background:var(--primary);
      color:#fff;
      text-align:center;
      padding:1rem;
    }
    footer a { color:#fff; text-decoration:underline; }
    main {
      flex:1;
      max-width:900px;
      width:100%;
      margin:1rem auto;
      padding:1rem;
    }
    .controls {
      display:flex; flex-wrap:wrap; gap:0.5rem;
      margin-bottom:1rem;
    }
    .controls button {
      padding:0.5rem 1rem;
      border:none; border-radius:4px;
      background:var(--primary); color:#fff;
      cursor:pointer; transition:background .2s;
    }
    .controls button:hover { background:var(--primary-dark); }
    .hidden { display:none; }
    /* Habit Form */
    #habitForm {
      display:flex; flex-wrap:wrap; gap:0.5rem;
      margin-bottom:1rem;
    }
    #habitForm input, #habitForm select, #habitForm input[type="time"] {
      padding:0.4rem; border:1px solid #ccc; border-radius:4px;
      font-size:1rem;
    }
    /* Habit List */
    #habitListContainer { margin-bottom:1rem; }
    #habitList { list-style:none; }
    #habitList li {
      background:var(--card); padding:.5rem;
      margin:.2rem 0; border-radius:4px;
      display:flex; justify-content:space-between;
      align-items:center;
    }
    #habitList li button {
      background:transparent; border:none; font-size:1rem;
      cursor:pointer;
    }
    /* Monthly View */
    #monthView {
      display:grid;
      grid-template-columns:repeat(7,1fr);
      gap:2px;
      background:var(--card);
      padding:4px;
      border-radius:6px;
      margin-bottom:1rem;
    }
    #monthView .day {
      padding:.5rem; text-align:right;
      background:rgba(0,0,0,0.05);
      cursor:pointer; user-select:none;
      border-radius:4px;
    }
    #monthView .day.done {
      background:var(--primary); color:#fff;
    }
    /* Weekly View */
    #weekView {
      width:100%; overflow-x:auto; margin-bottom:1rem;
    }
    #weekTable {
      width:100%; border-collapse:collapse;
      background:var(--card); border-radius:6px;
      overflow:hidden;
    }
    #weekTable th, #weekTable td {
      padding:8px; border:1px solid #eee;
      text-align:center; min-width:40px;
    }
    #weekTable td.habit {
      text-align:left; background:rgba(0,0,0,0.05);
    }
    #weekTable td.done {
      background:var(--primary); color:#fff;
    }
    /* Daily View */
    #dailyList { list-style:none; margin-bottom:1rem; }
    #dailyList li {
      background:var(--card); padding:.5rem;
      margin:.3rem 0; border-radius:4px;
      display:flex; justify-content:space-between;
      align-items:center; cursor:pointer; user-select:none;
    }
    #dailyList li.done {
      text-decoration:line-through; opacity:.6;
    }
    #dailyList li button {
      background:transparent; border:none; font-size:1rem;
      cursor:pointer;
    }
    /* Stats */
    #stats { background:var(--card); padding:1rem; border-radius:6px; }
  </style>
</head>
<body data-theme="light">
  <header>
    <h1>HabitFlow</h1>
    <p>Track habits with Monthly, Weekly, Daily views & reminders</p>
  </header>

  <main>
    <!-- create habit -->
    <div id="habitForm">
      <input type="text" id="habitName" placeholder="Habit name‚Ä¶" />
      <select id="habitIcon">
        <option>üî•</option><option>üí™</option><option>üßò</option>
        <option>üìö</option><option>üçé</option>
      </select>
      <input type="time" id="habitTime" title="Optional reminder time" />
      <button id="btnAddHabit">Add Habit</button>
    </div>

    <!-- list habits -->
    <div id="habitListContainer">
      <h3>Your Habits</h3>
      <ul id="habitList"></ul>
    </div>

    <!-- controls -->
    <div class="controls">
      <button data-view="month" class="btnView">Monthly</button>
      <button data-view="week"  class="btnView">Weekly</button>
      <button data-view="day"   class="btnView">Daily</button>
      <button id="btnStats">Stats</button>
      <button id="btnExport">Export</button>
      <button id="btnImport">Import</button>
      <button id="btnTheme">üåô Dark Mode</button>
      <input type="file" id="importInput" accept=".json" class="hidden"/>
    </div>

    <!-- views -->
    <div id="monthView" class="hidden"></div>

    <div id="weekView" class="hidden">
      <table id="weekTable">
        <thead><tr><th>Habit</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <ul id="dailyList" class="hidden"></ul>

    <div id="stats" class="hidden">
      <canvas id="statsChart" width="600" height="300"></canvas>
    </div>
  </main>

  <footer>
    ¬© 2025 Bocaletto Luca |
    <a href="https://github.com/bocaletto-luca/HabitFlow" target="_blank" rel="noopener">Repository</a>
  </footer>

  <!-- dependencies -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.7/dayjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const KEY = 'HabitFlowDB';
    let db = JSON.parse(localStorage.getItem(KEY) || '{"habits":[]}');
    function save(){ localStorage.setItem(KEY, JSON.stringify(db)); }

    // refs
    const hfName   = document.getElementById('habitName');
    const hfIcon   = document.getElementById('habitIcon');
    const hfTime   = document.getElementById('habitTime');
    const btnAdd   = document.getElementById('btnAddHabit');
    const listUL   = document.getElementById('habitList');
    const views    = {
      month: document.getElementById('monthView'),
      week:  document.getElementById('weekView'),
      day:   document.getElementById('dailyList'),
      stats: document.getElementById('stats')
    };
    const btnViews = [...document.querySelectorAll('.btnView')];
    const btnStats = document.getElementById('btnStats');
    const btnExp   = document.getElementById('btnExport');
    const btnImp   = document.getElementById('btnImport');
    const inpImp   = document.getElementById('importInput');
    const btnTheme = document.getElementById('btnTheme');
    const weekTbl  = document.getElementById('weekTable');
    const weekTbody= weekTbl.querySelector('tbody');
    const body     = document.body;
    let current = null;

    // helper
    const today = () => dayjs().format('YYYY-MM-DD');
    function toggle(v) {
      current = current===v? null : v;
      Object.keys(views).forEach(k=>{
        views[k].classList.toggle('hidden', current!==k);
      });
    }
    function notify(msg) {
      if(Notification.permission==='granted') new Notification('HabitFlow',{body:msg});
    }

    // render list
    function renderList(){
      listUL.innerHTML='';
      db.habits.forEach(h=>{
        const li=document.createElement('li');
        li.textContent=`${h.icon} ${h.name}`+(h.time?` @${h.time}`:'');
        const del=document.createElement('button');
        del.textContent='üóëÔ∏è';
        del.onclick=()=>{
          db.habits=db.habits.filter(x=>x.id!==h.id);
          save(); renderAll();
        };
        li.appendChild(del);
        listUL.appendChild(li);
      });
    }

    // monthly
    function renderMonth(){
      const m=views.month; m.innerHTML='';
      const dim=dayjs().daysInMonth();
      for(let d=1;d<=dim;d++){
        const date=dayjs().date(d).format('YYYY-MM-DD');
        const done=db.habits.some(h=>h.records?.[date]);
        const div=document.createElement('div');
        div.className='day'+(done?' done':'');
        div.textContent=d;
        div.onclick=()=>{
          db.habits.forEach(h=>{
            h.records=h.records||{};
            h.records[date]=!h.records[date];
          });
          save(); renderMonth();
        };
        m.appendChild(div);
      }
    }

    // weekly
    function renderWeek(){
      // header
      const thead=weekTbl.querySelector('thead tr');
      thead.innerHTML='<th>Habit</th>';
      for(let i=0;i<7;i++){
        const dow=dayjs().startOf('week').add(i,'day');
        const th=document.createElement('th');
        th.textContent=dow.format('dd').toUpperCase();
        thead.appendChild(th);
      }
      // body
      weekTbody.innerHTML='';
      db.habits.forEach(h=>{
        const tr=document.createElement('tr');
        const tdLab=document.createElement('td');
        tdLab.textContent=`${h.icon} ${h.name}`;
        tdLab.className='habit';
        tr.appendChild(tdLab);
        for(let i=0;i<7;i++){
          const date=dayjs().startOf('week').add(i,'day').format('YYYY-MM-DD');
          const td=document.createElement('td');
          if(h.records?.[date]) td.classList.add('done');
          td.onclick=()=>{
            h.records=h.records||{};
            h.records[date]=!h.records[date];
            save(); renderWeek();
          };
          tr.appendChild(td);
        }
        weekTbody.appendChild(tr);
      });
    }

    // daily
    function renderDay(){
      const ul=views.day; ul.innerHTML='';
      const dt=today();
      db.habits.slice().sort((a,b)=>(a.time||'')>(b.time||'')?1:-1)
      .forEach(h=>{
        const li=document.createElement('li');
        const done=!!h.records?.[dt];
        if(done) li.classList.add('done');
        li.innerHTML=`<span>${h.icon} ${h.name}${h.time?` @${h.time}`:''}</span><button>‚úîÔ∏è</button>`;
        li.querySelector('button').onclick=()=>{
          h.records=h.records||{};
          h.records[dt]=!h.records[dt];
          save(); renderDay();
          if(h.time&&h.records[dt]) notify(`Completed: ${h.name}`);
        };
        ul.appendChild(li);
      });
    }

    // stats
    function renderStats(){
      toggle('stats');
      const ctx=document.getElementById('statsChart').getContext('2d');
      const labels=db.habits.map(h=>h.name);
      const data=db.habits.map(h=>{
        const recs=Object.values(h.records||{});
        return recs.length?Math.round(recs.filter(Boolean).length/recs.length*100):0;
      });
      new Chart(ctx,{type:'bar',data:{labels,datasets:[{label:'% Done',data,backgroundColor:labels.map(()=>getComputedStyle(document.documentElement).getPropertyValue('--primary').trim())}]},options:{scales:{y:{beginAtZero:true,max:100}}}});
    }

    // render all
    function renderAll(){
      renderList();
      renderMonth();
      renderWeek();
      renderDay();
      toggle(current);
    }

    // bindings
    btnAdd.onclick=()=>{
      const name=hfName.value.trim();
      if(!name)return alert('Enter a habit name');
      db.habits.push({id:Date.now().toString(),name,icon:hfIcon.value,time:hfTime.value,records:{}});
      save(); hfName.value=''; hfTime.value='';
      renderAll();
    };
    btnViews.forEach(b=>b.onclick=()=>toggle(b.dataset.view));
    btnStats.onclick=renderStats;
    btnTheme.onclick=()=>{
      const t=body.dataset.theme==='light'?'dark':'light';
      body.dataset.theme=t;
      btnTheme.textContent=t==='dark'?'‚òÄÔ∏è Light Mode':'üåô Dark Mode';
    };
    btnExp.onclick=()=>{
      const blob=new Blob([JSON.stringify(db,null,2)],{type:'application/json'});
      const a=document.createElement('a');
      a.href=URL.createObjectURL(blob);
      a.download='habitflow-data.json';
      a.click();
      URL.revokeObjectURL(a.href);
    };
    btnImp.onclick=()=>inpImp.click();
    inpImp.onchange=e=>{
      const f=e.target.files[0];
      if(!f)return;
      const r=new FileReader();
      r.onload=()=>{
        try{db=JSON.parse(r.result);save();renderAll();alert('Imported');}
        catch{alert('Invalid JSON');}
      };
      r.readAsText(f);
      inpImp.value='';
    };

    Notification.requestPermission();
    renderAll();
  });
  </script>
</body>
</html>
